(function () {
  let sections = document.querySelectorAll('.section');
  let current = 0;
  let html = "";
  let main = document.getElementById('main');
  let scrollDown = document.querySelector('.scroll-down');
  let sec2 = document.querySelector('.section2__wrap');
  let sec3 = document.querySelector('.section3__wrap');
  let nav = document.querySelector('.pagination');

  for (let i = 0; i < sections.length; i++) {
    if (i == 0) {
      html += '<li id="' + i + '" class="dot active_dot"><span class="button"></span></li>';
    } else {
      html += '<li id="' + i + '" class="dot"><span class="button"></span></li>';
    }
  }

  nav.innerHTML = html;
  window.addEventListener('mousewheel', function (event) {
    if (event.wheelDelta >= 0) {
      scroll(-1);
    } else {
      scroll(1);
    }
  });
  let isScrolling = false;

  function scroll(dir) {
    if (isScrolling) {
      return;
    }

    isScrolling = true;

    if (dir == -1) {
      if (current > 0) {
        current--;
      }
    } else {
      if (current < sections.length - 1) {
        current++;
      }
    }

    let number = 100 * current;
    let value = "translateY(-" + number + "vh)";
    main.style.transform = value;

    if (number === 0) {
      sec2.style.transform = "translateY(140px)";
    }

    if (number === 100) {
      sec2.style.transform = "translateY(0px)";
      sec3.style.transform = "translateY(140px)";
    }

    if (number === 200) {
      scrollDown.classList.add('hide');
      sec2.style.transform = "translateY(-140px)";
      sec3.style.transform = "translateY(0px)";
    } else {
      scrollDown.classList.remove('hide');
    }

    for (let i = 0; i < sections.length; i++) {
      document.querySelector('.pagination li:nth-child(' + (i + 1) + ')').classList.remove('active_dot');
    }

    document.querySelector('.pagination li:nth-child(' + (current + 1) + ')').classList.add('active_dot');
    setTimeout(function () {
      isScrolling = false;
    }, 500);
  }

  function _swipe(obj) {
    let swdir,
        sX,
        sY,
        dX,
        dY,
        threshold = 100,
        slack = 50,
        alT = 500,
        elT,
        stT;
    obj.addEventListener('touchstart', function (e) {
      let tchs = e.changedTouches[0];
      swdir = 'none';
      sX = tchs.pageX;
      sY = tchs.pageY;
      stT = new Date().getTime();
    }, false);
    obj.addEventListener('touchmove', {
      passive: false
    }, function (e) {
      e.preventDefault();
    }, false);
    obj.addEventListener('touchend', function (e) {
      let tchs = e.changedTouches[0];
      dX = tchs.pageX - sX;
      dY = tchs.pageY - sY;
      elT = new Date().getTime() - stT;

      if (elT <= alT) {
        if (Math.abs(dX) >= threshold && Math.abs(dY) <= slack) {
          swdir = dX < 0 ? 'left' : 'right';
        } else if (Math.abs(dY) >= threshold && Math.abs(dX) <= slack) {
          swdir = dY < 0 ? 'up' : 'down';
        }

        if (swdir === 'up') {
          scroll(1);
        } else if (swdir === 'down' && obj.style.transform !== 'translateY(0)') {
          scroll(-1);
        }

        e.stopPropagation();
      }
    }, false);
  }

  _swipe(document.body);
})();